\section{Сильная нормализация}

\begin{definition}
Будем называть терм $A$ \emph{сильно нормализуемым} если
выполнено одно из следующих условий:
\begin{itemize}
\item $A$ в нормальной форме
\item $A\rightarrow_\beta B$ влечёт сильную нормализуемость $B$
\end{definition}

\begin{lemma}
Пусть $A$ --- сильно нормализуемый терм, тогда любая цепочка редукций неизбежно 
приводит к нормальной форме за конечное количество шагов.
\end{lemma}

\begin{proof}
Рассмотрим множество $N_0$ --- множество всех термов в нормальной форме.
Рассмотрим процесс его пополнения: $N_{n+1} = N_{n} \cup {A: \mbox{для всех} B A\rightarrow_\beta B \mbox{влечет} B \in N_{n}}$.
Тогда $\cup N_i = N^*$ будет содержать все сильно нормализуемые термы (доказательство очевидно из определения).

Пусть $С(A) = min {i : A \in N_i}$.
Очевидно, что если $A \rightarrow_\beta B$, то $C(A) > C(B)$. Отсюда следует конечность любой цепочки редукций.
\end{proof}

\begin{definition}
Определим множество $SN$ следующим индуктивным образом:
\begin{itemize}
\item Если $A_1 \in SN, \dots, A_n \in SN$ и $x$ --- переменная, то $x A_1 \dots A_N \in SN$.
\item Если $A \in SN$, то $\lambda x.A \in SN$
\item Если $A[x := B] A_1 \dots A_n \in SN$ и $B \in SN$, то $(\lambda x.A) B A_1 \dots A_n \in SN$.
\end{itemize}
\end{definition}

\begin{lemma}
Если $A \in SN$, то $A$ --- сильно нормализуемый терм.
\end{lemma}

\begin{proof}
Индукция по доказательству принадлежности терма $A$ к $SN$.
\begin{itemize}
\item $A \equiv x A_1 \dots A_N$, $A_i \in SN$. Тогда по предположению, $A_i$ --- сильно нормализуемые
\item $A \equiv \lambda x.B$. Тогда внешняя абстракция не может редуцироваться, а $B$ --- сильно нормализуемый (по предположению)
\item $A \equiv (\lambda x.P) Q R_1 \dots R_n$, $Q \in SN$ и $P[x := Q] R_1 \dots R_n \in SN$. 
Здесь есть очевидный бета-редекс, поэтому мы должны показать, 
что любой результат редукции выражения является сильно нормализуемым.

Рассмотрим индукцию по доказательству $Q$ и вспомогательную индукцию по $P[x := Q] R_1 \dots R_n$: если
$P[x := Q] R_1 \dots R_n \rightarrow S$ и $S \in SN$ влечет сильную нормализуемость $S$,
то и исходное выражение сильно нормализуемо.

%В данном случае Докажем это индукцией по доказательству принадлежности $Q$ к $SN$. Для всех $Q$ устроим вложенную
%индукцию по доказательству принадлежности $P[x := Q] R_1 \dots R_n$ к $SN$. То есть, для 


Разберем все варианты бета-редукции:
\begin{itemize}
\item $(\lambda x.P) Q R_1 \dots R_n \rightarrow_\beta (\lambda x.P') Q R_1 \dots R_n$.
В этом случае также и $P[x := Q] R_1 \dots R_n \rightarrow_\beta P'[x := Q] R_1 \dots R_n$.
Поскольку по предположению индукции $P[x:=Q] R_1 \dots R_n \in SN$ сильно нормализуемо, то и 
$P'[x := Q] R_1 \dots R_n$ сильно нормализуемо (определение нормализуемости), 
значит и $(\lambda x.P') Q R_1 \dots R_n$ сильно нормализуемо (по определению $SN$ и вспомогательной индукции).
\item $(\lambda x.P) Q R_1 \dots R_n \rightarrow_\beta (\lambda x.P) Q' R_1 \dots R_n$.
Значит, $P[x := Q] R_1 \dots R_n \rightrightarrow_\beta P[x := Q'] R_1 \dots R_n$, то есть
по несколько раз примененному предположению вложенной индукции $P[x := Q'] R_1 \dots R_n$ сильно 
нормализуем. Тогда $(\lambda x.P) Q' R_1 \dots R_n$ сильно нормализуем по индукционному предположению.
\item $(\lambda x.P) Q R_1 \dots R_n \rightarrow_\beta (\lambda x.P) Q R_1' \dots R_n$.

\item $P[x := Q] R_1 \dots R_n \rightarrow_\beta (\lambda x.P) Q R_1 \dots R_n$. В этом случае мы возвращаемся к
исходному выражению в построении множества $SN$.
\end{itemize}
\end{itemize}
\end{proof}

Теперь нам надо показать, что все просто типизированные лямбда-выражения принадлежат множеству $SN$.

\begin{lemma}
Пусть $R \in SN$ и $S^\rho \in SN$. Тогда $R S \in SN$ и $R [x := S] \in SN$.
\end{lemma}

\begin{proof}
%Индукция по структуре $rho$ и $R\in SN$. 
Проведем индукцию по структуре формул из множества $SN$. Будем считать, что 
условие леммы выполнено для любой формулы, которая проще предположения $R$ или имеет
тип проще $\rho$. Однако, переходить к следующему уровню сложности мы будем, перебирая 
варианты доказательства $R \in SN$. %Т.е. мы фиксируем некоторую формулу $R \in SN$ и тип
%$\rho$. 
\begin{itemize}
\item $R \equiv \lambda y.T$, $T \in SN$. Заметим, что $T[y := S] \in SN$ по второму утверждению, 
то
есть $$
Так как $(\lambda y.T) S \in SN$, то 
\end{itemize}
\end{proof}
